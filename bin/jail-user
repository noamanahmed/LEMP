#!/bin/bash

DIR=$(dirname "${BASH_SOURCE[0]}") 
DIR=$(realpath "${DIR}") 

template_path="$(cd $DIR/../ && pwd)/templates"

if [ "$EUID" -ne 0 ]
  then echo "Please run as root"
  exit
fi

while getopts u: flag
do
    case "${flag}" in
        u) username=${OPTARG};;        
    esac
done

if [ -z "$username" ]
then
    echo "Please provide a username using -u "
    exit
fi



if id "$username" &>/dev/null
then
    echo "The $username exists! Lets proceed!"    
else
    echo "The username $username is incorrect!"
    exit
fi

chroot_path=/var/chroot
chown root:root /home/$username/
cp -rf $chroot_path/* /home/$username/
cp -rf $chroot_path/.ssh /home/$username/
cp -rf $chroot_path/.bashrc /home/$username/.bashrc
cp -rf $chroot_path/.profile /home/$username/.profile
cp -rf $chroot_path/.wp-cli /home/$username/.wp-cli
cp -rf $chroot_path/.config /home/$username/.config


ln -s $chroot_path/php $chroot_path/bin/php74

mkdir -p /home/$username/tmp
chown -R $username:$username /home/$username/.wp-cli
chown -R $username:$username /home/$username/.bashrc
chown -R $username:$username /home/$username/.profile
chown -R $username:$username /home/$username/.config
chown -R $username:$username /home/$username/tmp
chown -R $username:$username /home/$username/etc
chown -R $username:$username /home/$username/usr
chown -R $username:$username /home/$username/lib
chown -R $username:$username /home/$username/lib64
chown -R $username:$username /home/$username/dev/null

