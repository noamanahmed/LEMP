#!/bin/bash

DIR=$(dirname "${BASH_SOURCE[0]}") 
DIR=$(realpath "${DIR}") 

template_path="$(cd $DIR/../ && pwd)/templates"
source $DIR/../includes/helpers.sh

if [ "$EUID" -ne 0 ]
  then echo "Please run as root"
  exit
fi

while [ $# -gt 0 ]; do
  case "$1" in
    -u|--username)
      username="$2"
      shift
      ;;
    -d|--domain)
      domain="$2"
      shift
      ;;
    --ssh_password)
      ssh_password=yes
      ;;
    --type)
      type="$2"
      shift
      ;;
    --mysql)
      mysql="$2"
      shift
      ;;
    --postgres)
      postgres="$2"
      shift
      ;;
    --database_name)
      database_name=yes
      ;;
    --database_user_name)
      database_user_name=yes
      ;;
    --database_password)
      database_password=yes
      ;;
    --redis)
      redis=yes      
      ;;
    --php)
      php="$2"
      shift
      ;;
    --wordpress)
      wordpress=yes
      ;;
    --wp_password)
      wp_password=yes
      ;;      
    --laravel)
      laravel=yes
      ;;
    --nossl)
      nossl=yes
      ;;       
    --no_monitoring)
      no_monitoring=yes
      ;;        
    *)
      printf "***************************\n"
      printf "* Error: Invalid argument. $1 *\n"
      printf "***************************\n"      
      exit 1
  esac  
  shift
done

if [ -z "$username" ]
then
    echo "Please provide a username using -u "
    exit
fi


if [ -z "$domain" ]
then
    echo "Please provide a domain using -d "
    exit
fi


if ! id "$username" &>/dev/null
then
    echo "The $username doesn't exists"
    exit
fi

output=""
output+="\n"
output+="Site Setup succssfull\n"
output+="URL : http://$domain\n"
if [ -z "$nossl" ]
then
output+="URL(SSL) : https://$domain\n"
fi
output+="Complete Path : /home/$username/www\n"
output+="\n"
if [ -n "$wordpress" ]
then
output+="\n"
output+="WordPress user: $username\n"
output+="WordPress password: $wp_password\n"
output+="\n"

fi

if [ -n "$mysql" ]
then
output+="\n"
output+="MySQL Database Credentials\n"
output+="Database name: $database_name\n"
output+="Database user: $database_user\n"
output+="Database password: $database_password\n"
output+="phpMyAdmin: https://$hostname/phpmyadmin\n"
fi


if [ -n "$postgres" ]
then
output+="\n"
output+="Postgres Database Credentials\n"
output+="Database name: $database_name\n"
output+="Database user: $database_user\n"
output+="Database password: $database_password\n"
output+="pgAdmin4 : https://$hostname/pgadmin4\n"
fi

output+="\n"
output+="SFTP/SSH Details\n"
output+="Host: $domain\n"
output+="Port: 22\n"
output+="Username: $username\n"
output+="Password: $user_password\n"

printf "$output"